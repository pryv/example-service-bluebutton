<html>
<head>
  <title>Pryv Backup button</title>
  <meta name="robots" content="noindex, nofollow">
  <!-- Include CSS File Here -->
  <link rel="stylesheet" href="css/style.css"/>
  <!-- Include CSS File Here -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="js/login.js"></script>
</head>
<body>
<div class="container">
  <div class="main">
    <form class="form" method="post" action="#">
      <h2>Pryv Login</h2>
      <label>Username :</label>
      <input type="text" name="dusername" id="username">
      <label>Password :</label>
      <input type="password" name="password" id="password">
      <input type="button" name="login" id="login" value="Login">
    </form>
  </div>

  <div class="consoleClass">
    <textarea cols=80 rows=10 name="console" id="console">

    </textarea>
  </div>
</div>




</body>
<script>
  $(document).ready(function(){

    // TODO: Add backup button
    // TODO: Handle response with status

    $("#login").click(function(){
      var username = $("#username").val();
      var password = $("#password").val();
// Checking for blank fields.
      if( username =='' || password ==''){
        $('input[type="text"],input[type="password"]').css("border","2px solid red");
        $('input[type="text"],input[type="password"]').css("box-shadow","0 0 3px red");
        alert("Please fill all fields...!!!!!!");
      } else {
        $.post("/login",{ username: username, password:password},
          function(data) {
            if(data){
              $("form")[0].reset();
              $('input[type="text"],input[type="password"]').css({"border":"2px solid #00F5FF","box-shadow":"0 0 5px #00F5FF"});
              $(function() {
                readStatus(username, data);
              });
            } else{
              $('input[type="text"],input[type="password"]').css({"border":"2px solid red","box-shadow":"0 0 3px red"});
              alert('Invalid login!');
            }
          });
      }
    });
  });

  var last_index = 0;
  function readStatus(username, token) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/status', true);

    xhr.onprogress = function () {
      var curr_index = xhr.responseText.length;
      if (last_index == curr_index) return;
      var s = xhr.responseText.substring(last_index, curr_index);
      last_index = curr_index;
      logToConsole(s);
    };
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.send(JSON.stringify({username: username, token: token}));
  };

  var $console = document.getElementById('console');

  function logToConsole(text) {
    $console.value = text;
    $console.scrollTop =$console.scrollHeight;
  }
  
</script>
</html>